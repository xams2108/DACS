"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.uploadBatch = uploadBatch;
const domains_js_1 = require("../../utils/domains.js");
const fetch_js_1 = require("../../utils/fetch.js");
const process_js_1 = require("../../utils/process.js");
const mock_js_1 = require("../mock.js");
async function uploadBatch(client, form, fileNames, options) {
    if (process_js_1.IS_TEST) {
        return (0, mock_js_1.addToMockStorage)(form);
    }
    const headers = {};
    const res = await (0, fetch_js_1.getClientFetch)(client)(`https://${(0, domains_js_1.getThirdwebDomains)().storage}/ipfs/upload`, {
        method: "POST",
        headers,
        body: form,
        requestTimeoutMs: client.config?.storage?.fetch?.requestTimeoutMs || 120000,
    });
    if (!res.ok) {
        if (res.status === 401) {
            throw new Error("Unauthorized - You don't have permission to use this service.");
        }
        if (res.status === 402) {
            throw new Error("You have reached your storage limit. Please add a valid payment method to continue using the service.");
        }
        if (res.status === 403) {
            throw new Error("Forbidden - You don't have permission to use this service.");
        }
        throw new Error(`Failed to upload files to IPFS - ${res.status} - ${res.statusText}`);
    }
    const body = await res.json();
    const cid = body.IpfsHash;
    if (!cid) {
        throw new Error("Failed to upload files to IPFS - Bad CID");
    }
    if (options?.uploadWithoutDirectory) {
        return [`ipfs://${cid}`];
    }
    return fileNames.map((name) => `ipfs://${cid}/${name}`);
}
//# sourceMappingURL=web-node.js.map