"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isSwapRequiredPostOnramp = isSwapRequiredPostOnramp;
exports.getOnRampSteps = getOnRampSteps;
const address_js_1 = require("../../utils/address.js");
/**
 * Check if a Swap is required after on-ramp when buying a token with fiat currency.
 *
 * If `quote.toToken` and `quote.onRampToken` are the same (same token and chain),
 * it means on-ramp provider can directly send the desired token to the user's wallet and no swap is required.
 *
 * If `quote.toToken` and `quote.onRampToken` are different (different token or chain), A swap is required to swap the on-ramp token to the desired token.
 *
 * @param buyWithFiatQuote - The quote of type [`BuyWithFiatQuote`](https://portal.thirdweb.com/references/typescript/v5/BuyWithFiatQuote) returned
 * by the [`getBuyWithFiatQuote`](https://portal.thirdweb.com/references/typescript/v5/getBuyWithFiatQuote) function.
 * @buyCrypto
 */
function isSwapRequiredPostOnramp(buyWithFiatQuote) {
    const sameChain = buyWithFiatQuote.toToken.chainId ===
        buyWithFiatQuote.onRampToken.token.chainId;
    const sameToken = (0, address_js_1.getAddress)(buyWithFiatQuote.toToken.tokenAddress) ===
        (0, address_js_1.getAddress)(buyWithFiatQuote.onRampToken.token.tokenAddress);
    return !(sameChain && sameToken);
}
function getOnRampSteps(buyWithFiatQuote) {
    const isSwapRequired = isSwapRequiredPostOnramp(buyWithFiatQuote);
    if (!isSwapRequired) {
        return [
            {
                action: "buy",
                token: buyWithFiatQuote.toToken,
                amount: buyWithFiatQuote.estimatedToAmountMin,
            },
        ];
    }
    if (buyWithFiatQuote.routingToken) {
        return [
            {
                action: "buy",
                token: buyWithFiatQuote.onRampToken.token,
                amount: buyWithFiatQuote.onRampToken.amount,
            },
            {
                action: "swap",
                token: buyWithFiatQuote.routingToken.token,
                amount: buyWithFiatQuote.routingToken.amount,
            },
            {
                action: "bridge",
                token: buyWithFiatQuote.toToken,
                amount: buyWithFiatQuote.estimatedToAmountMin,
            },
        ];
    }
    return [
        {
            action: "buy",
            token: buyWithFiatQuote.onRampToken.token,
            amount: buyWithFiatQuote.onRampToken.amount,
        },
        {
            action: "swap",
            token: buyWithFiatQuote.toToken,
            amount: buyWithFiatQuote.estimatedToAmountMin,
        },
    ];
}
//# sourceMappingURL=isSwapRequiredPostOnramp.js.map